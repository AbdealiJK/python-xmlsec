# all tests ignore import errors b/c mypy-testing-plugin
# can't resolve local stubs, see https://github.com/typeddjango/pytest-mypy-plugins/issues/17
- case: module-functions-allowed-calls
  mypy_config:
    ignore_missing_imports = True
  main: |
    import xmlsec
    xmlsec.enable_debug_trace()
    xmlsec.enable_debug_trace(True)
    xmlsec.enable_debug_trace(enabled=True)
    xmlsec.enable_debug_trace(enabled=False)
    xmlsec.init()
    xmlsec.shutdown()

- case: module-functions-disallowed-calls
  mypy_config:
    ignore_missing_imports = True
  main: |
    import xmlsec
    xmlsec.enable_debug_trace('')  # E: Argument 1 to "enable_debug_trace" has incompatible type "str"; expected "bool"
    xmlsec.enable_debug_trace(None)  # E: Argument 1 to "enable_debug_trace" has incompatible type "None"; expected "bool"
    xmlsec.enable_debug_trace(1)  # E: Argument 1 to "enable_debug_trace" has incompatible type "int"; expected "bool"
    xmlsec.enable_debug_trace(enabled='')  # E: Argument "enabled" to "enable_debug_trace" has incompatible type "str"; expected "bool"
    xmlsec.enable_debug_trace(enabled=None)  # E: Argument "enabled" to "enable_debug_trace" has incompatible type "None"; expected "bool"
    xmlsec.enable_debug_trace(enabled=1)  # E: Argument "enabled" to "enable_debug_trace" has incompatible type "int"; expected "bool"

- case: encyption-context-init
  mypy_config:
    ignore_missing_imports = True
  main: |
    import xmlsec
    ctx = xmlsec.EncryptionContext()

    mgr = xmlsec.KeysManager()
    ctx = xmlsec.EncryptionContext(mgr)
    ctx = xmlsec.EncryptionContext(manager=mgr)
    ctx = xmlsec.EncryptionContext(None)
    ctx = xmlsec.EncryptionContext(manager=None)

    ctx = xmlsec.EncryptionContext(True)  # E: Argument 1 to "EncryptionContext" has incompatible type "bool"; expected "Optional[KeysManager]"
    ctx = xmlsec.EncryptionContext('')  # E: Argument 1 to "EncryptionContext" has incompatible type "str"; expected "Optional[KeysManager]"
    ctx = xmlsec.EncryptionContext(1)  # E: Argument 1 to "EncryptionContext" has incompatible type "int"; expected "Optional[KeysManager]"
    ctx = xmlsec.EncryptionContext(manager=True)  # E: Argument "manager" to "EncryptionContext" has incompatible type "bool"; expected "Optional[KeysManager]"
    ctx = xmlsec.EncryptionContext(manager='')  # E: Argument "manager" to "EncryptionContext" has incompatible type "str"; expected "Optional[KeysManager]"
    ctx = xmlsec.EncryptionContext(manager=1)  # E: Argument "manager" to "EncryptionContext" has incompatible type "int"; expected "Optional[KeysManager]"

- case: encyption-context-attributes
  mypy_config:
    ignore_missing_imports = True
  main: |
    import xmlsec
    ctx = xmlsec.EncryptionContext()
    reveal_type(ctx.key)  # N: Revealed type is 'xmlsec.Key'
    ctx.key = None  # E: Incompatible types in assignment (expression has type "None", variable has type "Key")
    ctx.key = True  # E: Incompatible types in assignment (expression has type "bool", variable has type "Key")
    ctx.key = ''  # E: Incompatible types in assignment (expression has type "str", variable has type "Key")
    ctx.key = 1  # E: Incompatible types in assignment (expression has type "int", variable has type "Key")
